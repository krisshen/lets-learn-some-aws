<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quiz Grid</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white p-4 text-center">

  <h1 class="text-xl font-semibold mb-4">
    AIF-C01<br/>
    <span id="answered-count">0</span>/<span id="total-count">0</span>
  </h1>

  <div id="grid" class="grid grid-cols-10 gap-2 justify-center"></div>

  <!-- Modal -->
  <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="relative flex items-center justify-center w-full max-w-2xl mx-auto">
      <button id="prev-btn" aria-label="Previous" class="absolute -left-8 top-1/2 -translate-y-1/2 text-4xl px-3 py-2 text-gray-500 hover:text-black bg-white rounded-full shadow-lg z-50">&#8592;</button>
      <div class="bg-white p-6 rounded-xl w-full max-w-xl text-left flex items-start z-50">
        <div class="flex-1 min-w-0">
          <h2 class="text-lg font-bold mb-2" id="question-title">Question</h2>
          <div id="question" class="mb-4"></div>
          <div id="options" class="space-y-2"></div>
          <button onclick="closeModal()" class="mt-4 bg-gray-200 px-4 py-2 rounded">Close</button>
        </div>
      </div>
      <button id="next-btn" aria-label="Next" class="absolute -right-8 top-1/2 -translate-y-1/2 text-4xl px-3 py-2 text-gray-500 hover:text-black bg-white rounded-full shadow-lg z-50">&#8594;</button>
    </div>
  </div>

  <script>
    const grid = document.getElementById("grid");
    const answeredCount = document.getElementById("answered-count");
    const questions = [];
    const answered = new Set();
    const userAnswers = {};

    async function loadQuestions() {
      const response = await fetch("AIF-C01/questions.json");
      const data = await response.json();
      questions.push(...data);
      document.getElementById("total-count").textContent = questions.length;
      renderGrid();
    }

    function updateAnsweredCount() {
      answeredCount.textContent = answered.size;
    }

    function renderGrid() {
      grid.innerHTML = '';
      questions.forEach(q => {
        let btnClass = 'w-10 h-10 border rounded ';
        if (userAnswers[q.id]) {
          if (userAnswers[q.id] === q.answer) {
            btnClass += 'bg-green-300';
          } else {
            btnClass += 'bg-red-300';
          }
        } else {
          btnClass += 'bg-gray-100';
        }
        const btn = document.createElement("button");
        btn.className = btnClass;
        btn.textContent = q.id;
        btn.onclick = () => openModal(q.id);
        grid.appendChild(btn);
      });
      updateAnsweredCount();
    }

    let currentModalId = null;
    let currentQuestionIndex = 0;
    function openModal(id) {
      currentModalId = id;
      currentQuestionIndex = questions.findIndex(q => q.id === id);
      const modal = document.getElementById("modal");
      const q = questions.find(q => q.id === id);
      // Split question into title and content
      const parts = q.question.split(/\n\n/);
      const title = parts[0].replace(/^## /, "");
      const content = parts.slice(1).join("\n\n").replace(/\n/g, "<br>");
      document.getElementById("question-title").textContent = title;
      document.getElementById("question").innerHTML = content;
      const optionsDiv = document.getElementById("options");
      optionsDiv.innerHTML = '';

      for (const key in q.options) {
        const optBtn = document.createElement("button");
        optBtn.textContent = `${key}. ${q.options[key]}`;
        // Set color based on user selection and correctness
        if (userAnswers[q.id]) {
          if (userAnswers[q.id] === key) {
            if (key === q.answer) {
              optBtn.className = "block w-full text-left p-2 border rounded bg-green-300";
            } else {
              optBtn.className = "block w-full text-left p-2 border rounded bg-red-300";
            }
          } else {
            optBtn.className = "block w-full text-left p-2 border rounded hover:bg-gray-100";
          }
        } else {
          optBtn.className = "block w-full text-left p-2 border rounded hover:bg-gray-100";
        }
        optBtn.onclick = () => {
          userAnswers[q.id] = key;
          answered.add(id);
          renderGrid();
          openModal(id); // re-render modal to update option color, do not close
        };
        optionsDiv.appendChild(optBtn);
      }

      // Add prev/next button logic
      document.getElementById("prev-btn").onclick = showPrevQuestion;
      document.getElementById("next-btn").onclick = showNextQuestion;

      modal.classList.remove("hidden");
      modal.classList.add("flex");
    }

    function showPrevQuestion() {
      const prevIndex = (currentQuestionIndex - 1 + questions.length) % questions.length;
      openModal(questions[prevIndex].id);
    }

    function showNextQuestion() {
      const nextIndex = (currentQuestionIndex + 1) % questions.length;
      openModal(questions[nextIndex].id);
    }

    function closeModal() {
      document.getElementById("modal").classList.add("hidden");
    }

    // Keyboard navigation
    window.addEventListener('keydown', function(e) {
      if (document.getElementById('modal').classList.contains('hidden')) return;
      if (e.key === 'ArrowLeft') {
        showPrevQuestion();
        e.preventDefault();
      } else if (e.key === 'ArrowRight') {
        showNextQuestion();
        e.preventDefault();
      }
    });

    // Load questions
    loadQuestions();
  </script>
</body>
</html>
